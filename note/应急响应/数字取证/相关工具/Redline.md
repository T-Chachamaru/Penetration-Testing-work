#### 概述：什么是 Redline？ (Overview: What is Redline?)

在对可能被入侵的端点进行内存分析时，分析师有多种工具可选。其中最著名的深度分析工具是 **Volatility**，但其过程可能非常耗时。在时间紧迫的应急响应场景中，分析师需要一种能够快速评估情况的工具。

这正是 FireEye (现为 Trellix) 开发的 **Redline** 发挥作用的地方。Redline 是一款免费的应急响应工具，能够为分析师提供对 Windows、Linux 或 macOS 端点“三万英尺高空”的俯瞰视角。通过其友好的图形用户界面（GUI），您可以快速分析内存转储和各种文件系统结构，轻松发现恶意活动的迹象。

#### 1. 证据收集 (Evidence Collection)

使用 Redline 收集数据主要有三种方法。

##### 三种收集方法 (Three Collection Methods)

1. **标准收集器 (Standard Collector)**:
    
    - **功能**: 配置脚本以收集分析所需的**最小数据量**。
        
    - **优点**: 速度最快，通常在几分钟内完成。这是最常用的首选方法。
        
2. **全面收集器 (Comprehensive Collector)**:
    
    - **功能**: 配置脚本以从主机收集**最全面的数据**，用于深度分析。
        
    - **缺点**: 耗时较长，可能需要一小时或更长时间。
        
3. **IOC 搜索收集器 (IOC Search Collector) - (仅限 Windows)**:
    
    - **功能**: 收集与您预先创建的**攻击指标 (Indicators of Compromise, IOCs)** 相匹配的数据。
        
    - **用途**: 当您已经掌握了与特定攻击相关的 IOCs（如文件哈希、IP 地址等）并希望在端点上进行针对性搜索时，应选择此方法。
        

##### 创建标准收集器 (Creating a Standard Collector)

###### a. 编辑收集器脚本

这是配置过程中的关键步骤。在创建标准收集器时，点击 **“编辑您的脚本” (Edit your script)**，可以精确选择要从主机上收集的数据。

- **内存 (Memory)**:
    
    - 进程列表、驱动程序枚举（仅限 Windows）、钩子检测（Windows 10 之前的版本）。
        
- **磁盘 (Disk)**:
    
    - 磁盘分区和卷信息、文件枚举。
        
- **系统 (System)**:
    
    - 机器和操作系统信息、系统还原点（Windows 10 之前的版本）、注册表 Hive、用户账户、组信息、预取缓存（仅限 Windows）。
        
- **网络 (Network)**:
    
    - 网络信息、ARP/路由表、浏览器历史记录（对于调查恶意文件下载和 C2 通信至关重要）。
        
- **其他 (Other)**:
    
    - 系统服务、计划任务以及它们的关联哈希值。
        

###### b. 保存并运行收集器

1. **保存**: 选择完数据选项后，点击 **“浏览” (Browse)** 将收集器保存到一个**空的文件夹**中。这一步很重要，因为 Redline 会在该文件夹中生成脚本和后续的分析文件。
    
2. **运行**: 进入该文件夹，找到名为 `RunRedlineAudit.bat` 的批处理文件。**以管理员身份运行**此脚本。
    
3. **收集**: 脚本运行时会弹出一个命令提示符窗口。数据收集完成后，该窗口会自动关闭。
    

###### c. 分析文件 (.mans)

脚本运行结束后，在 `Sessions` 子文件夹中会生成一个扩展名为 `.mans` 的分析文件，例如 `AnalysisSession1.mans`。这个文件包含了所有收集到的数据，可以直接导入 Redline 进行调查。

> **提示**: 如果您多次运行收集脚本，分析文件的名称会自动递增（`AnalysisSession1`, `AnalysisSession2`...）。

#### 2. Redline 界面与分析 (The Redline Interface and Analysis)

双击 `.mans` 文件，数据将自动导入 Redline。界面左侧的面板是进行调查的核心，包含了所有分析数据。

##### 系统信息 (System Information)

提供关于机器、BIOS、操作系统和用户的基本信息。

##### 进程分析 (Process Analysis)

这是发现恶意活动的关键区域。

- **主视图**: 显示进程名称、PID、路径、命令行参数、父进程、用户名等。
    
- **深入分析 (可展开的四个部分)**:
    
    - **句柄 (Handles)**: 显示进程与系统资源（如文件、注册表键）的连接。
        
    - **内存段 (Memory Sections)**: **重点关注区域**。许多合法进程加载的 DLL 都是经过数字签名的。如果在这里发现任何**未签名的 DLL**，则非常可疑，值得深入调查。
        
    - **字符串 (Strings)**: 显示从进程内存中捕获的可读字符串。
        
    - **端口 (Ports)**: **重点关注区域**。恶意软件通常会通过网络连接与其 C2 服务器通信。在这里审查可疑的入站/出站连接，特别是要警惕那些**不应该有网络活动的系统进程**（如 `explorer.exe`, `notepad.exe`）建立了出站连接。
        

##### 其他关键分析部分 (Other Key Analysis Sections)

- **文件系统 (File System)**: 检查可疑文件的创建和修改。
    
- **注册表 (Registry)**: 查找持久化项或其他恶意修改。
    
- **Windows 服务 (Windows Services)**: 寻找被恶意软件创建或劫持的服务。
    
- **任务 (Tasks)**: 威胁行为者常通过创建计划任务来实现**持久化**。
    
- **事件日志 (Event Logs)**: 查找可疑的 PowerShell 事件、异常的登录/注销活动、新用户创建等。
    
- **ARP 和路由条目 (ARP and Route Entries)**
    
- **浏览器历史 (Browser URL & File Download History)**
    

##### 时间轴分析 (Timeline Analysis)

时间轴功能可以将所有收集到的事件（如文件创建、进程启动、网络连接等）按时间顺序排列，帮助分析师理解攻击的全过程。

- **TimeWrinkles™**: 一种时间过滤功能。如果您知道可疑活动发生的大致时间，可以使用它来快速缩小时间轴的显示范围，只关注该时间段内的事件。
    
- **TimeCrunches™**: 一种数据降噪功能。它会自动隐藏在指定时间窗口内（例如 1 分钟）发生的重复性事件，帮助您从海量数据中聚焦于关键的、非重复性的行为。