# 渗透测试-信息收集

## 信息收集方法
信息收集是渗透测试的核心环节，以下是常用的方法与工具：

### 1. Ping 和 超级 Ping
- **Ping**  
  - 通过Ping目标域名获取IP地址，结合IP地址的地理位置进行对比，判断是否是源站IP，或使用`nslookup`解析域名下的IP。
  - 如果发现多个IP位于同一网段，则可能存在负载均衡或高可用配置，判断可能为真实IP。
  - 检查Ping返回字段，判断是否使用了CDN，但字段可能被隐藏。
- **超级Ping**  
  - 从多个地理位置同时Ping目标，验证IP地址的一致性，进一步确认真实IP。

### 2. 泛域名解析
- **定义**：如`*.baidu.com`，将所有下级域名解析到同一IP，优先级最低。
- **应用**：利用泛域名解析特性，绕过CDN，获取目标的真实IP地址。

### 3. DNS 劫持与 DNS 污染
- **DNS 劫持**：DNS服务器将访问重定向到与原地址不同的IP。
- **DNS 污染**：DNS服务器解析域名到一个不存在的IP，导致用户无法访问。
- **意义**：了解这些干扰因素有助于识别目标的真实解析情况。

### 4. 使用 dnsenum 收集子域名
- **工具**：`dnsenum`，运行于Kali Linux。
- **用法**：`dnsenum --enum 域名`，通过内置字典枚举子域名。
- **注意**：需配置代理以提高效率或绕过限制。

### 5. 备案号查询
- 通过查询网站ICP备案（ICP编号或域名），获取与目标公司相关的所有域名信息。

### 6. SSL 证书查询
- 通过域名查询SSL证书，提取证书中的信息以确定源站IP。

### 7. 搜索引擎高级用法
- **inurl**：搜索URL中包含指定值的网页。
- **related**：查找与目标网站相似的网站。
- **intext**：搜索网页正文中包含的文字，忽略标题和URL。
- **filetype**：搜索特定文件类型（如PDF、DOC）的网页。
- **intitle**：搜索标题中包含关键字的网页。
- **allintitle**：搜索标题由所有指定关键字构成的网页。
- **link**：查找指向特定URL的页面。
- **location**：限定搜索的国家或区域。
- **site**：限定搜索范围为特定域名。

### 8. 使用 Layer 爆破收集子域名
- 通过字典爆破目标域名，枚举出所有可能的子域名。

### 9. 在线收集子域名
- 使用站长之家、爱站、ip138、腾讯云域名查询、ICANN等在线工具快速收集子域名。

### 10. 安全领域常用搜索引擎
- **[Shodan](https://www.shodan.io/)**：搜索联网设备。
- **[FOFA](https://fofa.info/)**：网络空间搜索引擎。
- **[ZoomEye](https://www.zoomeye.org/)**：全球网络资产搜索。

### 11. 使用 Python 工具收集子域名
- **SubDomainBrute**：高并发，速度快。
- **Sublist3r**：字典丰富，覆盖广泛。

### 12. 使用 JS 收集子域名
- 检查网站加载的JS文件，可能包含子域名信息。
- **工具**：JSFinder，LinkFinder。

### 13. DNS 历史解析记录
- 查询目标域名的历史DNS解析记录，绕过CDN。
- **工具**：DnsDB。
- **资源**：安全厂商威胁情报中心、微步在线。

### 14. 政府网站收集
- 通过政府网站（如[zfwzzc.www.gov.cn](http://zfwzzc.www.gov.cn)）收集相关域名信息。

### 15. 验证真实 IP
- 通过ICP备案地点验证IP地址的准确性。
- CDN通常选择国内或全球加速，可通过国外访问绕过。
- 使用`Nmap`扫描网段，检查开放的443端口，修改host解析访问，结合SSL证书验证IP真实性。
- 查询地址分配机构，分析IP归属及数据中心信息。

### 16. APP 信息收集
- 使用Burp Suite抓取APP的HTTP请求，提取URL。
- 反编译APP，查看内置的URL信息。

### 17. Burp Suite 抓包
- **配置**：将代理设置为127.0.0.1，指向Burp Suite，捕获目标的所有数据包。
- **功能**：
  - 在火狐浏览器中配置代理，开启拦截，抓取并修改数据包。
  - 使用仪表盘扫描潜在漏洞。
- **HTTPS 抓包**：默认抓取HTTPS会报不安全，需从[http://burp](http://burp)下载证书并安装到受信任的根证书颁发机构。

### 18. 常见端口
端口：21 服务：FTP/TFTP/VSFTPD 总结：爆破/嗅探/溢出/后门
端口：22 服务：ssh远程连接      总结：爆破/openssh漏洞
端口：23 服务：Telnet远程连接   总结：爆破/嗅探/弱口令
端口：25 服务：SMTP邮件服务     总结：邮件伪造
端口：53 服务：DNS域名解析系统   总结：域传送/劫持/缓存投毒/欺骗
端口：67/68 服务：dhcp服务      总结：劫持/欺骗
端口：110 服务：pop3              总结：爆破/嗅探
端口：139 服务：Samba服务         总结：爆破/未授权访问/远程命令执行
端口：143 服务：Imap协议         总结：爆破161SNMP协议爆破/搜集目标内网信息
端口：389 服务：Ldap目录访问协议 总结：注入/未授权访问/弱口令
端口：445 服务：smb              总结：ms17-010/端口溢出
端口：512/513/514 服务：Linux Rexec服务 总结：爆破/Rlogin登陆
端口：873 服务：Rsync服务                 总结：文件上传/未授权访问
端口：1080 服务：socket                  总结：爆破
端口：1352 服务：Lotus domino邮件服务   总结：爆破/信息泄漏
端口：1433 服务：mssql                  总结：爆破/注入/SA弱口令
端口：1521 服务：oracle       总结：爆破/注入/TNS爆破/反弹shell2049Nfs服务配置不当
端口：2181 服务：zookeeper服务            总结：未授权访问
端口：2375 服务：docker remote api    总结：未授权访问
端口：3306 服务：mysql                 总结：爆破/注入
端口：3389 服务：Rdp远程桌面链接        总结：爆破/shift后门
端口：4848 服务：GlassFish控制台       总结：爆破/认证绕过
端口：5000 服务：sybase/DB2数据库      总结：爆破/注入/提权
端口：5432 服务：postgresql             总结：爆破/注入/缓冲区溢出
端口：5632 服务：pcanywhere服务        总结：抓密码/代码执行
端口：5900 服务：vnc                     总结：爆破/认证绕过
端口：6379 服务：Redis数据库           总结：未授权访问/爆破
端口：7001/7002 服务：weblogic         总结：java反序列化/控制台弱口令
端口：80/443 服务：http/https         总结：web应用漏洞/心脏滴血
端口：8069 服务：zabbix服务            总结：远程命令执行/注入
端口：8161 服务：activemq             总结：弱口令/写文件
端口：8080/8089 服务：Jboss/Tomcat/Resin 总结：爆破/PUT文件上传/反序列化
端口：8083/8086 服务：influxDB         总结：未授权访问
端口：9000 服务：fastcgi                 总结：远程命令执行
端口：9090 服务：Websphere             总结：控制台爆破/java反序列化/弱口令
端口：9200/9300 服务：elasticsearch   总结：远程代码执行
端口：11211 服务：memcached             总结：未授权访问
端口：27017/27018 服务：mongodb         总结：未授权访问/爆破

## 其他工具
- **hping3**：可用于模拟DoS攻击，测试目标网络响应。

## 总结
信息收集是渗透测试的基础，直接影响后续环节的成功率。通过Ping、超级Ping、泛域名解析、DNS枚举、备案查询、SSL证书分析、搜索引擎、
爆破工具、在线资源、安全搜索引擎、Python脚本、JS提取、历史DNS记录、政府网站、IP验证、APP分析及Burp Suite抓包等多种方法，
可以全面获取目标信息。熟练运用这些技术和工具，将显著提升渗透测试的效率与效果。