# Apache Shiro < 1.5.2 认证绕过漏洞 (CVE-2020-1957)

## 概述 (Overview)

此漏洞影响 Apache Shiro 1.5.2 之前的版本。当 Shiro 与 Spring Framework 等使用动态路由或控制器的 Web 框架集成时，攻击者可以通过构造特定的 URL 路径来绕过 Shiro 的身份验证和授权检查，访问受保护的资源。 (通常使用 `vulhub` 等靶场环境进行复现)。

## 漏洞原理 (Vulnerability Principle)

漏洞源于 Shiro 在处理 URL 路径时与某些 Web 框架（如 Spring）处理方式的不一致。Shiro 在进行权限匹配前会对 URL 路径进行规范化处理，但其处理方式可能无法正确解析包含 `;` (分号) 的路径段，特别是当与 `..` (目录穿越符) 结合使用时。

例如，攻击者构造如下 URL：
`/public_resource/..;/protected_resource/admin_page`

*   **Shiro 的处理**: Shiro 可能会因为 `;` 的存在而错误地解析路径，例如在处理 `..;` 时可能仅进行目录穿越而忽略分号后的部分，导致其认为请求的路径是 `/public_resource/` 或其他非受保护路径，从而放行。
*   **Web 框架 (如 Spring) 的处理**: Spring 框架可能能正确解析整个路径，将其路由到 `/protected_resource/admin_page` 对应的控制器。

由于 Shiro 的权限检查被绕过，而请求最终被路由到了受保护的资源，攻击者成功实现了认证绕过。

## 利用示例 (Exploitation Example)

假设 `/admin/` 目录受 Shiro 保护，需要登录才能访问。攻击者可以尝试构造如下 URL 来绕过检查：

`http://target.com/public_path/..;/admin/`

如果 `public_path` 是一个无需认证即可访问的路径，这个构造的 URL 就有可能绕过 Shiro 对 `/admin/` 的访问控制。