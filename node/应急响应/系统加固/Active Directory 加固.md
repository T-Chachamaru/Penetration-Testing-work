#### 概述：Active Directory 核心概念 (Overview: Core Active Directory Concepts)

- **域 (Domain)**: Active Directory 逻辑结构的核心单元，用于存储和管理域内所有对象（用户、计算机、组等）的信息。
    
- **域控制器 (Domain Controller)**: 域的“大脑”，是一台运行 Active Directory 域服务 (AD DS) 的 Windows 服务器。它负责处理用户身份验证、授权访问 IT 资源以及复制目录信息。
    
- **树 (Tree)**: 一个或多个共享连续 DNS 命名空间的域的集合。树中的域通过信任关系共享资源。
    
- **森林 (Forest)**: 一个或多个树的集合，它们共享一个公共的全局目录、目录架构和配置。森林是 Active Directory 中最外层的安全边界。
    
- **AD 信任 (AD Trusts)**: 在不同域之间建立的通信桥梁，用于管理跨域的资源共享。信任可以是**传递式**（信任关系可以继承）或**非传递式**，也可以是**单向**或**双向**的。
    
- **容器 (Containers)** 与 **叶对象 (Leaf Objects)**: 在 AD 中，所有实体（用户、计算机、打印机等）都是对象。能够包含其他对象的对象（如组织单位 OU）被称为容器；不能包含其他对象的对象（如单个用户）被称为叶对象。
    

#### 1. 保护认证方法 (Protecting Authentication Methods)

##### 禁用 LAN 管理器哈希 (Disable LAN Manager Hash)

LM 哈希是一种过时且非常脆弱的密码哈希算法。为防止快速的暴力破解攻击，必须禁止 Windows 存储密码的 LM 哈希。

- **路径**: `组策略管理编辑器 > 计算机配置 > 策略 > Windows 设置 > 安全设置 > 本地策略 > 安全选项 > 网络安全: 不在下一次密码更改时存储 LAN Manager 的哈希值`
    
- **操作**: 启用此策略。
    

##### 强制 SMB 签名 (Enforce SMB Signing)

服务器消息块 (SMB) 协议用于文件和打印共享。强制进行 SMB 签名可以确保数据包的完整性，有效防范中间人 (MiTM) 攻击。

- **路径**: `组策略管理编辑器 > ... > 安全选项 > Microsoft 网络服务器: 数字签名通信(始终)`
    
- **操作**: 启用此策略。
    

##### 强制 LDAP 签名 (Enforce LDAP Signing)

轻量级目录访问协议 (LDAP) 用于查询和修改目录服务。强制 LDAP 签名可以防止攻击者通过重放攻击或 MiTM 攻击发送伪造的 LDAP 请求。

- **路径**: `组策略管理编辑器 > ... > 安全选项 > 域控制器: LDAP 服务器签名要求`
    
- **操作**: 从下拉菜单中选择 **“要求签名” (Require signing)**。
    

#### 2. 密码安全策略 (Password Security Policies)

##### 密码轮换 (Password Rotation)

定期轮换密码，特别是服务账户的密码，是至关重要的安全措施。

- **方法**:
    
    1. **脚本化**: 使用 PowerShell 计划任务来自动化服务账户的密码轮换。
        
    2. **多因素认证 (MFA)**: 为账户添加 MFA 可以降低密码泄露的风险，从而适当放宽密码轮换的频率。
        
    3. **gMSAs**: 使用**组管理服务账户 (group Managed Service Accounts)**，Windows 会自动为其轮换密码（通常每 30 天一次）。
        

##### 密码策略 (Password Policy)

制定严格的密码策略是抵御暴力破解、字典攻击和密码喷洒等攻击的第一道防线。

- **路径**: `组策略管理编辑器 > ... > 安全设置 > 账户策略 > 密码策略`
    
- **关键设置**:
    
    - **强制密码历史**: 至少设置为 `10` 到 `15`，防止用户重复使用旧密码。
        
    - **最小密码长度**: 至少设置为 `10` 到 `14` 个字符。
        
    - **密码必须符合复杂性要求**: 确保密码包含大写字母、小写字母、数字和特殊字符的组合，并且不包含用户名。
        

#### 3. 实施最小权限模型 (Implementing the Least Privilege Model)

> **最小权限原则 (Principle of Least Privilege)**: “在一个计算环境的特定抽象层中，每个模块（如进程、用户或程序）只能访问其合法目的所必需的信息和资源”。

##### 分层访问模型 (Tiered Access Model - TAM)

TAM 通过创建安全边界来分离 AD 中的资产，以保护价值最高的身份。

- **Tier 0**: **最高权限层**。包括域管理员、域控制器、企业管理员组等。此层的凭证绝不能泄露到较低层级。
    
- **Tier 1**: 域成员服务器和应用程序。
    
- **Tier 2**: 最终用户设备（工作站、笔记本电脑）。
    

##### 账户审计 (Auditing Accounts)

- **使用审计**: 监控每个账户执行的具体任务，验证其访问权限是否合理。
    
- **权限审计**: 定期检查系统中每个账户是否遵循了最小权限原则。
    
- **变更审计**: 查找对账户权限、密码或设置的任何不当更改。
    

#### 4. 微软安全合规工具包 (Microsoft Security Compliance Toolkit - MSCT)

MSCT 是微软官方提供的工具包，用于在域环境中快速部署和管理安全基线。

- **安装安全基线**: 微软提供了预开发的、基于最佳实践的安全配置基线（以组策略对象 GPO 备份的形式）。下载后，可以通过脚本将其导入到你的组策略中。
    
- **策略分析器 (Policy Analyzer)**: MSCT 中的一个工具，允许你比较不同的组策略对象 (GPO)，以快速发现不一致性、冗余设置或配置漂移。
    

#### 5. 防范已知攻击 (Protecting Against Known Attacks)

##### Kerberoasting

这是一种后渗透技术，攻击者请求与服务账户关联的 Kerberos 服务票据，然后离线暴力破解该票据以获取服务账户的明文密码。

- **缓解措施**:
    
    - 确保服务账户使用长而复杂的密码（25个字符以上）。
        
    - 使用 gMSAs，因为它们使用更长、更复杂的、并且会定期轮换的密码。
        
    - 监控异常的服务票据请求。
        

##### 弱密码与易猜密码

这是最常见的安全漏洞。必须通过严格的**密码策略**来强制用户使用强密码。

##### RDP 暴力破解

远程桌面协议 (RDP) 是攻击者常用的入口点。

- **缓解措施**: **绝不**将 RDP 端口直接暴露在公共互联网上。应使用 VPN、Azure Bastion 或其他安全网关进行访问，并启用网络级别身份验证 (NLA) 和 MFA。
    

##### 公开可访问的共享

配置不当的网络共享是横向移动的温床。

- **缓解措施**: 定期使用 PowerShell cmdlet `Get-SmbOpenFile` 来审计网络上打开的文件，发现不应有的共享和访问，并相应地配置访问权限。